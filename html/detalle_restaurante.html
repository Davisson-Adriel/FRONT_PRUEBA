<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalles del Restaurante</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../styles/detalle_restaurante.css">
    <style>
        /* Estilos para el modal de rese√±as */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            border-radius: 15px 15px 0 0;
        }

        .modal-header h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.5rem;
        }

        .boton-cerrar-modal {
            background: none;
            border: none;
            font-size: 2rem;
            color: #666;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
        }

        .boton-cerrar-modal:hover {
            color: #e74c3c;
        }

        .modal-body {
            padding: 20px;
        }

        .resenas-container {
            margin-bottom: 20px;
        }

        .sin-resenas {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
        }

        .error-resenas {
            text-align: center;
            color: #e74c3c;
            padding: 40px 20px;
        }

        .cargando {
            text-align: center;
            color: #3498db;
            padding: 40px 20px;
        }
    </style>
</head>
<body>
    <!-- Header con informaci√≥n del restaurante -->
    <header class="encabezado-detalle">
        <div class="contenedor-header">
            <button class="boton-volver" id="btnVolver">
                <span class="flecha-volver">‚Üê</span>
                <span class="texto-volver">Volver</span>
            </button>
            <div class="info-restaurante-header" id="infoRestauranteHeader">
                <!-- Se llenar√° din√°micamente -->
            </div>
        </div>
    </header>

    <!-- Contenido principal -->
    <main class="contenido-principal">
        <div class="contenedor-principal">
            
            <!-- Secci√≥n de informaci√≥n detallada del restaurante -->
            <section class="seccion-info-restaurante">
                <div class="tarjeta-info-completa" id="infoRestauranteCompleta">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </section>

            <!-- Secci√≥n de platos del restaurante -->
            <section class="seccion-platos-restaurante">
                <div class="encabezado-seccion">
                    <h2 class="titulo-seccion">Nuestros Platos</h2>
                    <div class="filtros-container">
                        <select class="filtro-categoria" id="filtroPlatos">
                            <option value="todos">Todas las categor√≠as</option>
                            <option value="entradas">Entradas</option>
                            <option value="principales">Platos Principales</option>
                            <option value="postres">Postres</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="ensaladas">Ensaladas</option>
                        </select>
                    </div>
                </div>

                <div class="grid-contenido" id="gridPlatos">
                    <!-- Los platos se cargar√°n din√°micamente -->
                </div>
            </section>

            <!-- Secci√≥n de rese√±as del restaurante -->
            <section class="seccion-resenas-restaurante">
                <div class="encabezado-seccion">
                    <h2 class="titulo-seccion">Rese√±as del Restaurante</h2>
                    <button class="boton-crear-resena-restaurante" id="btnCrearResenaRestaurante">
                        Escribir Rese√±a
                    </button>
                </div>
                <div class="contenedor-resenas" id="contenedorResenasRestaurante">
                    <!-- Las rese√±as se cargar√°n din√°micamente -->
                </div>
            </section>

        </div>
    </main>

    <!-- Modal de Rese√±as de Platos -->
    <div id="modalResenas" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="tituloModal">Rese√±as de Plato</h2>
                <button class="boton-cerrar-modal" id="cerrarModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="resenas-container" id="resenasContainer">
                    <!-- Las rese√±as se cargar√°n din√°micamente aqu√≠ -->
                </div>
                <div class="acciones-modal">
                    <button class="boton-crear-resena" id="btnCrearResena">Crear Rese√±a</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Crear Rese√±a -->
    <div id="modalCrearResena" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="tituloModalCrear">Crear Nueva Rese√±a</h2>
                <button class="boton-cerrar-modal" id="cerrarModalCrear">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formCrearResena" class="form-resena">
                    <div class="campo-form">
                        <label for="nombreUsuarioResena">Tu nombre:</label>
                        <input type="text" id="nombreUsuarioResena" required>
                    </div>
                    <div class="campo-form">
                        <label for="calificacionResena">Calificaci√≥n:</label>
                        <div class="estrellas-container">
                            <span class="estrella" data-rating="1">‚òÜ</span>
                            <span class="estrella" data-rating="2">‚òÜ</span>
                            <span class="estrella" data-rating="3">‚òÜ</span>
                            <span class="estrella" data-rating="4">‚òÜ</span>
                            <span class="estrella" data-rating="5">‚òÜ</span>
                        </div>
                        <input type="hidden" id="calificacionResena" required>
                    </div>
                    <div class="campo-form">
                        <label for="comentarioResena">Tu rese√±a:</label>
                        <textarea id="comentarioResena" rows="4" placeholder="Escribe tu experiencia aqu√≠..." required></textarea>
                    </div>
                    <div class="acciones-form">
                        <button type="button" class="boton-cancelar" id="cancelarResena">Cancelar</button>
                        <button type="submit" class="boton-enviar">Enviar Rese√±a</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script>
        // Base de datos simulada de restaurantes con informaci√≥n detallada
        const restaurantesData = {
            'Pasta Roma': {
                nombre: 'Pasta Roma',
                imagen: 'https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=800&h=400&fit=crop&crop=center',
                categoria: 'italiana',
                calificacion: 4.8,
                descripcion: 'Aut√©ntica cocina italiana en el coraz√≥n de la ciudad. Especialistas en pasta fresca hecha a mano y salsas tradicionales de la Toscana.',
                horarios: 'Lunes a Domingo: 12:00 PM - 11:00 PM',
                telefono: '+1 (555) 123-4567',
                direccion: 'Calle Principal 123, Centro Hist√≥rico',
                especialidades: ['Pasta Carbonara', 'Lasagna Bolognesa', 'Risotto de Mariscos', 'Tiramisu Casero'],
                platos: [
                    {
                        nombre: 'Pasta Carbonara',
                        imagen: 'https://images.unsplash.com/photo-1608897013039-887f21d8c804?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Spaghetti al dente con pancetta, huevo, parmesano y pimienta negra reci√©n molida',
                        precio: '$19.99',
                        calificacion: 4.8,
                        categoria: 'principales'
                    },
                    {
                        nombre: 'Lasagna Bolognesa',
                        imagen: 'https://images.unsplash.com/photo-1571997478779-2adcbbe9ab2f?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Lasagna tradicional con carne de res, salsa bechamel y quesos italianos',
                        precio: '$22.99',
                        calificacion: 4.9,
                        categoria: 'principales'
                    },
                    {
                        nombre: 'Tiramisu Italiano',
                        imagen: 'https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Postre italiano tradicional con caf√© espresso, mascarpone y cacao',
                        precio: '$8.99',
                        calificacion: 4.9,
                        categoria: 'postres'
                    },
                    {
                        nombre: 'Ensalada Caprese',
                        imagen: 'https://images.unsplash.com/photo-1546793665-c74683f339c1?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Tomates frescos, mozzarella di bufala, albahaca y aceite de oliva extra virgen',
                        precio: '$14.99',
                        calificacion: 4.6,
                        categoria: 'ensaladas'
                    }
                ]
            },
            'Tacos Del Sol': {
                nombre: 'Tacos Del Sol',
                imagen: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=800&h=400&fit=crop&crop=center',
                categoria: 'mexicana',
                calificacion: 4.7,
                descripcion: 'Aut√©ntica comida mexicana con recetas familiares transmitidas por generaciones. Ingredientes frescos y salsas picantes caseras.',
                horarios: 'Martes a Domingo: 11:00 AM - 10:00 PM',
                telefono: '+1 (555) 987-6543',
                direccion: 'Avenida M√©xico 456, Zona Rosa',
                especialidades: ['Tacos Al Pastor', 'Quesadillas Oaxaque√±as', 'Chiles en Nogada', 'Flan Napolitano'],
                platos: [
                    {
                        nombre: 'Tacos Al Pastor',
                        imagen: 'https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Tacos tradicionales con carne de cerdo marinada, pi√±a, cebolla y cilantro fresco',
                        precio: '$12.99',
                        calificacion: 4.7,
                        categoria: 'principales'
                    },
                    {
                        nombre: 'Quesadillas de Flor de Calabaza',
                        imagen: 'https://images.unsplash.com/photo-1513456852971-30c0b8199d4d?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Quesadillas artesanales con flor de calabaza, epazote y queso Oaxaca',
                        precio: '$10.99',
                        calificacion: 4.5,
                        categoria: 'entradas'
                    },
                    {
                        nombre: 'Agua de Horchata',
                        imagen: 'https://images.unsplash.com/photo-1570197788417-0e82375c9371?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Bebida tradicional de arroz con canela, az√∫car y leche condensada',
                        precio: '$4.99',
                        calificacion: 4.8,
                        categoria: 'bebidas'
                    }
                ]
            },
            'Burger House': {
                nombre: 'Burger House',
                imagen: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=800&h=400&fit=crop&crop=center',
                categoria: 'americana',
                calificacion: 4.6,
                descripcion: 'Las mejores hamburguesas gourmet de la ciudad. Carne 100% Angus, pan artesanal y ingredientes premium.',
                horarios: 'Todos los d√≠as: 11:00 AM - 12:00 AM',
                telefono: '+1 (555) 246-8135',
                direccion: 'Boulevard Am√©ricas 789, Zona Comercial',
                especialidades: ['Burger Cl√°sica', 'BBQ Bacon Burger', 'Papas R√∫sticas', 'Milkshakes'],
                platos: [
                    {
                        nombre: 'Hamburguesa Gourmet',
                        imagen: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Hamburguesa de carne Angus con queso suizo, tocino, lechuga y tomate en pan brioche',
                        precio: '$16.99',
                        calificacion: 4.7,
                        categoria: 'principales'
                    },
                    {
                        nombre: 'Papas R√∫sticas',
                        imagen: 'https://images.unsplash.com/photo-1513456852971-30c0b8199d4d?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Papas artesanales cortadas a mano con sal marina y romero',
                        precio: '$8.99',
                        calificacion: 4.5,
                        categoria: 'entradas'
                    },
                    {
                        nombre: 'Milkshake de Vainilla',
                        imagen: 'https://images.unsplash.com/photo-1570197788417-0e82375c9371?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Batido cremoso de vainilla natural con crema batida y cereza',
                        precio: '$6.99',
                        calificacion: 4.6,
                        categoria: 'bebidas'
                    }
                ]
            },
            'Dragon Wok': {
                nombre: 'Dragon Wok',
                imagen: 'https://images.unsplash.com/photo-1617093727343-374698b1b08d?w=800&h=400&fit=crop&crop=center',
                categoria: 'asiatica',
                calificacion: 4.5,
                descripcion: 'Aut√©ntica cocina asi√°tica fusi√≥n con t√©cnicas tradicionales del wok. Ingredientes frescos y sabores intensos.',
                horarios: 'Martes a Domingo: 12:00 PM - 10:30 PM',
                telefono: '+1 (555) 369-2580',
                direccion: 'Plaza Asia 321, Distrito Gastron√≥mico',
                especialidades: ['Pad Thai', 'Pollo Agridulce', 'Rollitos Primavera', 'T√© Jasmine'],
                platos: [
                    {
                        nombre: 'Dragon Roll',
                        imagen: 'https://images.unsplash.com/photo-1563379091339-03246963d29c?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Rollo de sushi con tempura de camar√≥n, aguacate, anguila y salsa teriyaki',
                        precio: '$22.99',
                        calificacion: 4.8,
                        categoria: 'principales'
                    },
                    {
                        nombre: 'Pad Thai Cl√°sico',
                        imagen: 'https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Fideos de arroz salteados con camarones, tofu, cacahuetes y salsa tamarindo',
                        precio: '$18.99',
                        calificacion: 4.6,
                        categoria: 'principales'
                    }
                ]
            },
            'Sweet Dreams': {
                nombre: 'Sweet Dreams',
                imagen: 'https://images.unsplash.com/photo-1578985545062-69928b1d9587?w=800&h=400&fit=crop&crop=center',
                categoria: 'postres',
                calificacion: 4.9,
                descripcion: 'Pasteler√≠a artesanal especializada en postres gourmet y reposter√≠a francesa. Endulza tus mejores momentos.',
                horarios: 'Lunes a S√°bado: 8:00 AM - 9:00 PM, Domingo: 10:00 AM - 8:00 PM',
                telefono: '+1 (555) 147-8520',
                direccion: 'Calle Dulce 159, Centro Comercial',
                especialidades: ['Macarons Franceses', 'Cheesecake NY', 'Chocolate Belga', 'Cupcakes'],
                platos: [
                    {
                        nombre: 'Tiramisu Italiano',
                        imagen: 'https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Postre italiano tradicional con caf√© espresso, mascarpone y cacao',
                        precio: '$8.99',
                        calificacion: 4.9,
                        categoria: 'postres'
                    },
                    {
                        nombre: 'Cheesecake de Frutos Rojos',
                        imagen: 'https://images.unsplash.com/photo-1464349095431-e9a21285b5f3?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Cheesecake cremoso de vainilla con coulis de frutos rojos',
                        precio: '$9.99',
                        calificacion: 4.6,
                        categoria: 'postres'
                    }
                ]
            },
            'Green Garden': {
                nombre: 'Green Garden',
                imagen: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=800&h=400&fit=crop&crop=center',
                categoria: 'vegetariana',
                calificacion: 4.7,
                descripcion: 'Restaurante 100% vegetariano con opciones veganas. Comida saludable, fresca y llena de sabor natural.',
                horarios: 'Todos los d√≠as: 9:00 AM - 9:00 PM',
                telefono: '+1 (555) 789-4561',
                direccion: 'Eco Plaza 753, Zona Verde',
                especialidades: ['Bowl Detox', 'Quinoa Salad', 'Smoothie Verde', 'Burger Vegana'],
                platos: [
                    {
                        nombre: 'Ensalada Caesar Vegana',
                        imagen: 'https://images.unsplash.com/photo-1546793665-c74683f339c1?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Ensalada con lechuga romana, crutones de ajo y aderezo caesar vegano',
                        precio: '$14.99',
                        calificacion: 4.5,
                        categoria: 'ensaladas'
                    },
                    {
                        nombre: 'Smoothie Verde Detox',
                        imagen: 'https://images.unsplash.com/photo-1570197788417-0e82375c9371?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Batido verde con espinaca, mango, pi√±a y semillas de ch√≠a',
                        precio: '$6.99',
                        calificacion: 4.6,
                        categoria: 'bebidas'
                    }
                ]
            },
            'Pizzeria Napoli': {
                nombre: 'Pizzeria Napoli',
                imagen: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=800&h=400&fit=crop&crop=center',
                categoria: 'italiana',
                calificacion: 4.8,
                descripcion: 'Aut√©ntica pizzer√≠a napolitana con horno de le√±a tradicional. Masa madre fermentada 24 horas.',
                horarios: 'Martes a Domingo: 5:00 PM - 11:00 PM',
                telefono: '+1 (555) 456-7890',
                direccion: 'Via Italia 852, Little Italy',
                especialidades: ['Pizza Margarita', 'Quattro Stagioni', 'Calzone', 'Gelato Artesanal'],
                platos: [
                    {
                        nombre: 'Pizza Margarita',
                        imagen: 'https://images.unsplash.com/photo-1604068549290-dea0e4a305ca?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Pizza cl√°sica con salsa de tomate, mozzarella fresca, albahaca y aceite de oliva',
                        precio: '$18.99',
                        calificacion: 4.9,
                        categoria: 'principales'
                    }
                ]
            },
            'Sakura Sushi': {
                nombre: 'Sakura Sushi',
                imagen: 'https://images.unsplash.com/photo-1551218808-94e220e084d2?w=800&h=400&fit=crop&crop=center',
                categoria: 'asiatica',
                calificacion: 4.6,
                descripcion: 'Sushi bar tradicional japon√©s con chefs especializados. Pescado fresco importado diariamente.',
                horarios: 'Lunes a S√°bado: 6:00 PM - 12:00 AM',
                telefono: '+1 (555) 321-6549',
                direccion: 'Sakura Street 963, Distrito Japon√©s',
                especialidades: ['Sashimi Premium', 'Ramen Tradicional', 'Maki Rolls', 'Sake Premium'],
                platos: [
                    {
                        nombre: 'Dragon Roll Premium',
                        imagen: 'https://images.unsplash.com/photo-1563379091339-03246963d29c?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Rollo especial con anguila, aguacate, camar√≥n tempura y caviar',
                        precio: '$24.99',
                        calificacion: 4.8,
                        categoria: 'principales'
                    }
                ]
            },
            'BBQ Master': {
                nombre: 'BBQ Master',
                imagen: 'https://images.unsplash.com/photo-1544025162-d76694265947?w=800&h=400&fit=crop&crop=center',
                categoria: 'americana',
                calificacion: 4.5,
                descripcion: 'Barbacoa aut√©ntica estilo americano. Carnes ahumadas lentamente con maderas especiales.',
                horarios: 'Mi√©rcoles a Domingo: 4:00 PM - 11:00 PM',
                telefono: '+1 (555) 654-9870',
                direccion: 'BBQ Boulevard 741, Smokehouse District',
                especialidades: ['Costillas BBQ', 'Brisket Ahumado', 'Pulled Pork', 'Mac & Cheese'],
                platos: [
                    {
                        nombre: 'Alitas BBQ Picantes',
                        imagen: 'https://images.unsplash.com/photo-1541014741259-de529411b96a?w=400&h=250&fit=crop&crop=center',
                        descripcion: 'Alitas de pollo ahumadas con salsa BBQ picante y aderezo ranch',
                        precio: '$13.99',
                        calificacion: 4.6,
                        categoria: 'entradas'
                    }
                ]
            }
        };

        // Base de datos de rese√±as (extendida para incluir m√°s restaurantes)
        let resenasData = {
            // Restaurantes
            'Pasta Roma': [
                { nombre: 'Mar√≠a Gonz√°lez', calificacion: 5, comentario: 'Excelente pasta italiana, ambiente muy acogedor y servicio impecable', fecha: '2024-10-20' },
                { nombre: 'Carlos L√≥pez', calificacion: 4, comentario: 'Muy buena comida, el tiramisu es espectacular', fecha: '2024-10-18' },
                { nombre: 'Ana Mart√≠nez', calificacion: 5, comentario: 'La mejor carbonara que he probado, totalmente aut√©ntica', fecha: '2024-10-15' }
            ],
            'Tacos Del Sol': [
                { nombre: 'Roberto Silva', calificacion: 5, comentario: 'Los mejores tacos de la ciudad, totalmente recomendado', fecha: '2024-10-22' },
                { nombre: 'Sofia Chen', calificacion: 4, comentario: 'Sabores aut√©nticos mexicanos, las salsas est√°n perfectas', fecha: '2024-10-19' }
            ],
            'Burger House': [
                { nombre: 'Diego Ram√≠rez', calificacion: 4, comentario: 'Hamburguesas jugosas y papas crujientes, buen ambiente', fecha: '2024-10-21' },
                { nombre: 'Laura Vega', calificacion: 5, comentario: 'La carne es de excelente calidad, definitivamente volver√©', fecha: '2024-10-16' }
            ],
            // Platos espec√≠ficos
            'Pasta Carbonara': [
                { nombre: 'Luis Rodr√≠guez', calificacion: 5, comentario: 'Perfecta, ingredientes frescos y t√©cnica impecable', fecha: '2024-10-21' },
                { nombre: 'Isabella Torres', calificacion: 4, comentario: 'Muy rica, el queso parmesano estaba perfecto', fecha: '2024-10-19' }
            ],
            'Tacos Al Pastor': [
                { nombre: 'Miguel Hern√°ndez', calificacion: 5, comentario: 'Aut√©nticos tacos al pastor, la pi√±a le da el toque perfecto', fecha: '2024-10-20' }
            ],
            'Hamburguesa Gourmet': [
                { nombre: 'Carmen Delgado', calificacion: 4, comentario: 'Muy sabrosa, la carne en su punto exacto', fecha: '2024-10-18' }
            ]
        };

        let restauranteActual = '';
        let itemActual = '';

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', async function() {
            const restauranteId = localStorage.getItem('restauranteSeleccionado');
            
            if (!restauranteId) {
                alert('Restaurante no encontrado');
                window.location.href = 'principal_usar.html';
                return;
            }

            console.log('üîç Valor recibido:', restauranteId);
            console.log('üîç Tipo:', typeof restauranteId);
            
            try {
                let restauranteActualTemp = null;
                
                // Si es un n√∫mero, buscar por ID
                if (!isNaN(parseInt(restauranteId))) {
                    console.log('üî¢ Buscando por ID num√©rico:', parseInt(restauranteId));
                    restauranteActualTemp = await RestaurantesAPI.getById(parseInt(restauranteId));
                } 
                
                // Si no se encontr√≥ por ID o no es n√∫mero, buscar por nombre en la lista
                if (!restauranteActualTemp) {
                    console.log('üîç Buscando por nombre en lista completa...');
                    const todosLosRestaurantes = await RestaurantesAPI.getAll();
                    console.log('üìã Restaurantes disponibles:', todosLosRestaurantes);
                    
                    restauranteActualTemp = todosLosRestaurantes.find(r => 
                        r.nombre === restauranteId || 
                        r.id == restauranteId ||
                        String(r.id) === String(restauranteId)
                    );
                }
                
                restauranteActual = restauranteActualTemp;
                console.log('‚úÖ Respuesta de la API:', restauranteActual);
                
                if (!restauranteActual) {
                    console.error('‚ùå RestaurantesAPI devolvi√≥ null/undefined');
                    alert('Restaurante no encontrado');
                    window.location.href = 'principal_usar.html';
                    return;
                }

                console.log('üè™ Restaurante cargado:', restauranteActual.nombre);
                cargarInformacionRestaurante();
                cargarPlatosRestaurante();
                cargarResenasRestaurante();
                
            } catch (error) {
                console.error('‚ùå Error completo:', error);
                console.error('‚ùå Stack trace:', error.stack);
                alert(`Error al cargar el restaurante: ${error.message}`);
                window.location.href = 'principal_usar.html';
            }
        });

        // Cargar informaci√≥n del restaurante
        function cargarInformacionRestaurante() {
            const restaurante = restauranteActual; // Ahora restauranteActual es el objeto del restaurante
            
            // Adaptar datos del backend
            const imagen = restaurante.imagen_url || 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&h=400&fit=crop&crop=center';
            const categorias = {
                1: 'Fast Food',
                2: 'Gourmet', 
                3: 'Vegetariano',
                4: 'Italiano',
                5: 'Parrilla',
                6: 'Ensaladas'
            };
            const categoria = categorias[restaurante.categoriaId] || 'Restaurante';

            // Header
            document.getElementById('infoRestauranteHeader').innerHTML = `
                <div class="imagen-header-container">
                    <img src="${imagen}" alt="${restaurante.nombre}" class="imagen-header"
                         onerror="this.src='https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&h=400&fit=crop&crop=center'">
                </div>
                <div class="info-header-texto">
                    <h1 class="nombre-restaurante">${restaurante.nombre}</h1>
                    <div class="calificacion-header">
                        <span class="categoria-tag">${categoria}</span>
                    </div>
                </div>
            `;

            // Informaci√≥n completa
            document.getElementById('infoRestauranteCompleta').innerHTML = `
                <div class="info-principal">
                    <div class="imagen-principal-container">
                        <img src="${imagen}" alt="${restaurante.nombre}" class="imagen-principal"
                             onerror="this.src='https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&h=400&fit=crop&crop=center'">
                    </div>
                    <div class="detalles-restaurante">
                        <h2 class="nombre-restaurante-detalle">${restaurante.nombre}</h2>
                        <p class="descripcion-restaurante">${restaurante.descripcion}</p>
                        
                        <div class="info-contacto">
                            <div class="item-contacto">
                                <strong>üìç Direcci√≥n:</strong> ${restaurante.direccion}
                            </div>
                            <div class="item-contacto">
                                <strong>üè∑Ô∏è Categor√≠a:</strong> ${categoria}
                            </div>
                            <div class="item-contacto">
                                <strong>üÜî ID:</strong> ${restaurante.id}
                            </div>
                        </div>

                        <div class="descripcion-completa">
                            <h3>üìã Informaci√≥n:</h3>
                            <p>${restaurante.descripcion}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Cargar platos del restaurante
        async function cargarPlatosRestaurante() {
            try {
                const todosLosPlatos = await PlatosAPI.getAll();
                const platosRestaurante = todosLosPlatos.filter(plato => plato.id_restaurante == restauranteActual.id);
                const grid = document.getElementById('gridPlatos');
                
                if (platosRestaurante.length === 0) {
                    grid.innerHTML = '<div class="sin-datos">Este restaurante a√∫n no tiene platos registrados.</div>';
                    return;
                }
            
                grid.innerHTML = platosRestaurante.map(plato => `
                    <div class="tarjeta-item">
                        <div class="imagen-container">
                            <img src="${plato.imagen_url || 'https://images.unsplash.com/photo-1546554137-f86b9593a222?w=400&h=250&fit=crop'}" 
                                 alt="${plato.nombre}" 
                                 class="imagen-item"
                                 onerror="this.src='https://images.unsplash.com/photo-1546554137-f86b9593a222?w=400&h=250&fit=crop'">
                        </div>
                        <div class="info-item">
                            <h3 class="nombre-item">${plato.nombre}</h3>
                            <p class="descripcion-item">${plato.descripcion}</p>
                            <div class="detalles-item">
                                <span class="precio">üí∞ $${plato.precio}</span>
                            </div>
                            <div class="acciones-item">
                                <button class="boton-ver-resenas" onclick="verResenasPlato(${plato.id}, '${plato.nombre}')">
                                    Ver Rese√±as
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error cargando platos:', error);
                document.getElementById('gridPlatos').innerHTML = 
                    '<div class="sin-datos">‚ùå Error al cargar los platos</div>';
            }
        }

        // Cargar rese√±as del restaurante
        async function cargarResenasRestaurante() {
            try {
                const container = document.getElementById('contenedorResenasRestaurante');
                
                // Cargar rese√±as del restaurante desde la API
                console.log('üîç Cargando rese√±as para restaurante ID:', restauranteActual.id);
                const todasLasResenas = await ResenasRestaurantesAPI.obtenerTodas();
                const resenasRestaurante = todasLasResenas.filter(resena => resena.restauranteId === parseInt(restauranteActual.id));
                
                console.log('üìã Rese√±as encontradas:', resenasRestaurante.length);
                
                if (resenasRestaurante.length === 0) {
                    container.innerHTML = '<p class="sin-resenas">A√∫n no hay rese√±as para este restaurante. ¬°S√© el primero en crear una!</p>';
                    return;
                }
                
                // Cargar informaci√≥n de usuarios para mostrar nombres
                const usuarios = await UsuariosAPI.obtenerTodos();
                const usuariosMap = {};
                usuarios.forEach(usuario => {
                    usuariosMap[usuario.id] = usuario;
                });
                
                // Generar HTML de rese√±as
                container.innerHTML = resenasRestaurante.map(resena => {
                    const usuario = usuariosMap[resena.usuarioId] || { username: 'Usuario desconocido' };
                    const fecha = new Date(resena.fecha).toLocaleDateString('es-ES');
                    
                    return `
                        <div class="resena-item">
                            <div class="resena-header">
                                <h4 class="nombre-usuario">${usuario.username}</h4>
                                <div class="calificacion-estrellas">${'‚òÖ'.repeat(resena.calificacion)}${'‚òÜ'.repeat(5 - resena.calificacion)}</div>
                                <span class="fecha-resena">${fecha}</span>
                            </div>
                            <p class="comentario-resena">${resena.comentario}</p>
                            <div class="resena-footer">
                                <span class="likes">üëç ${resena.likes} likes</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('‚ùå Error cargando rese√±as:', error);
                document.getElementById('contenedorResenasRestaurante').innerHTML = 
                    '<p class="sin-resenas">‚ùå Error al cargar las rese√±as</p>';
            }
        }

        // Bot√≥n volver
        document.getElementById('btnVolver').addEventListener('click', function() {
            window.location.href = 'principal_usar.html';
        });

        // Filtro de platos
        document.getElementById('filtroPlatos').addEventListener('change', function() {
            const filtro = this.value;
            const grid = document.getElementById('gridPlatos');
            aplicarFiltro(filtro, grid);
        });

        function aplicarFiltro(filtro, grid) {
            const tarjetas = grid.querySelectorAll('.tarjeta-item');
            
            tarjetas.forEach(tarjeta => {
                const categoria = tarjeta.getAttribute('data-categoria');
                
                if (filtro === 'todos' || categoria === filtro) {
                    tarjeta.style.display = 'block';
                    tarjeta.style.animation = 'fadeIn 0.3s ease';
                } else {
                    tarjeta.style.display = 'none';
                }
            });
        }

        // Manejar clics en botones de platos
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('boton-ver-resenas')) {
                const nombreItem = e.target.closest('.tarjeta-item').querySelector('.nombre-item').textContent;
                mostrarModalResenas(nombreItem);
            }
        });

        // Crear rese√±a del restaurante
        document.getElementById('btnCrearResenaRestaurante').addEventListener('click', function() {
            itemActual = restauranteActual;
            document.getElementById('tituloModalCrear').textContent = `Rese√±a para ${restauranteActual}`;
            document.getElementById('modalCrearResena').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            const nombreUsuario = localStorage.getItem('nombreUsuario') || '';
            document.getElementById('nombreUsuarioResena').value = nombreUsuario;
        });

        // Funci√≥n para mostrar el modal de rese√±as de platos
        function mostrarModalResenas(nombreItem) {
            itemActual = nombreItem;
            const modal = document.getElementById('modalResenas');
            const titulo = document.getElementById('tituloModal');
            const container = document.getElementById('resenasContainer');
            
            titulo.textContent = `Rese√±as de ${nombreItem}`;
            
            // Limpiar container
            container.innerHTML = '';
            
            // Obtener rese√±as del item
            const resenas = resenasData[nombreItem] || [];
            
            if (resenas.length === 0) {
                container.innerHTML = '<p class="sin-resenas">A√∫n no hay rese√±as para este plato. ¬°S√© el primero en crear una!</p>';
            } else {
                resenas.forEach(resena => {
                    const resenaElement = crearElementoResena(resena);
                    container.appendChild(resenaElement);
                });
            }
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Funci√≥n para crear elemento de rese√±a
        function crearElementoResena(resena) {
            const div = document.createElement('div');
            div.className = 'resena-item';
            
            const estrellas = '‚òÖ'.repeat(resena.calificacion) + '‚òÜ'.repeat(5 - resena.calificacion);
            
            div.innerHTML = `
                <div class="resena-header">
                    <h4 class="nombre-usuario">${resena.nombre}</h4>
                    <div class="calificacion-estrellas">${estrellas}</div>
                    <span class="fecha-resena">${resena.fecha}</span>
                </div>
                <p class="comentario-resena">${resena.comentario}</p>
            `;
            
            return div;
        }

        // Manejar modales (cerrar, crear, etc.)
        document.getElementById('cerrarModal').addEventListener('click', function() {
            document.getElementById('modalResenas').style.display = 'none';
            document.body.style.overflow = 'auto';
        });

        document.getElementById('btnCrearResena').addEventListener('click', function() {
            document.getElementById('modalResenas').style.display = 'none';
            document.getElementById('tituloModalCrear').textContent = `Rese√±a para ${itemActual}`;
            document.getElementById('modalCrearResena').style.display = 'flex';
            
            const nombreUsuario = localStorage.getItem('nombreUsuario') || '';
            document.getElementById('nombreUsuarioResena').value = nombreUsuario;
        });

        document.getElementById('cerrarModalCrear').addEventListener('click', function() {
            cerrarModalCrearResena();
        });

        document.getElementById('cancelarResena').addEventListener('click', function() {
            cerrarModalCrearResena();
        });

        function cerrarModalCrearResena() {
            document.getElementById('modalCrearResena').style.display = 'none';
            document.body.style.overflow = 'auto';
            limpiarFormularioResena();
        }

        // Sistema de estrellas
        const estrellas = document.querySelectorAll('.estrella');
        let calificacionSeleccionada = 0;

        estrellas.forEach(estrella => {
            estrella.addEventListener('click', function() {
                calificacionSeleccionada = parseInt(this.getAttribute('data-rating'));
                document.getElementById('calificacionResena').value = calificacionSeleccionada;
                actualizarEstrellas();
            });

            estrella.addEventListener('mouseover', function() {
                const rating = parseInt(this.getAttribute('data-rating'));
                destacarEstrellas(rating);
            });
        });

        document.querySelector('.estrellas-container').addEventListener('mouseleave', function() {
            actualizarEstrellas();
        });

        function destacarEstrellas(rating) {
            estrellas.forEach((estrella, index) => {
                if (index < rating) {
                    estrella.textContent = '‚òÖ';
                    estrella.style.color = '#ffc107';
                } else {
                    estrella.textContent = '‚òÜ';
                    estrella.style.color = '#ddd';
                }
            });
        }

        function actualizarEstrellas() {
            destacarEstrellas(calificacionSeleccionada);
        }

        // Enviar rese√±a
        document.getElementById('formCrearResena').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('nombreUsuarioResena').value.trim();
            const calificacion = parseInt(document.getElementById('calificacionResena').value);
            const comentario = document.getElementById('comentarioResena').value.trim();
            
            if (!nombre || !calificacion || !comentario) {
                alert('Por favor, completa todos los campos');
                return;
            }
            
            // Crear nueva rese√±a
            const nuevaResena = {
                nombre: nombre,
                calificacion: calificacion,
                comentario: comentario,
                fecha: new Date().toISOString().split('T')[0]
            };
            
            // Agregar a la base de datos
            if (!resenasData[itemActual]) {
                resenasData[itemActual] = [];
            }
            resenasData[itemActual].unshift(nuevaResena);
            
            // Cerrar modal y mostrar confirmaci√≥n
            cerrarModalCrearResena();
            alert('¬°Rese√±a creada exitosamente!');
            
            // Si es una rese√±a del restaurante, recargar la secci√≥n
            if (itemActual === restauranteActual) {
                cargarResenasRestaurante();
            } else {
                // Si es de un plato, volver a mostrar el modal actualizado
                setTimeout(() => {
                    mostrarModalResenas(itemActual);
                }, 500);
            }
        });

        function limpiarFormularioResena() {
            document.getElementById('formCrearResena').reset();
            calificacionSeleccionada = 0;
            actualizarEstrellas();
        }

        // Cerrar modales al hacer clic fuera
        window.addEventListener('click', function(e) {
            const modalResenas = document.getElementById('modalResenas');
            const modalCrear = document.getElementById('modalCrearResena');
            
            if (e.target === modalResenas) {
                modalResenas.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
            
            if (e.target === modalCrear) {
                cerrarModalCrearResena();
            }
        });

        // Funci√≥n para ver rese√±as de un plato (igual que en principal_usar.html)
        function verResenasPlato(id, nombrePlato) {
            console.log('üî• === EJECUTANDO verResenasPlato ===');
            console.log('‚≠ê Ver rese√±as de plato ID:', id, 'nombre:', nombrePlato);
            console.log('üîç Tipo de mostrarModalResenas:', typeof mostrarModalResenas);
            
            // Verificar que el modal existe
            const modal = document.getElementById('modalResenas');
            console.log('üé≠ Modal encontrado:', modal);
            
            // Usar la funci√≥n mostrarModalResenas que ya funciona
            if (typeof mostrarModalResenas === 'function') {
                console.log('‚úÖ Llamando a mostrarModalResenas...');
                mostrarModalResenas(nombrePlato, 'plato', id);
            } else {
                console.error('‚ùå mostrarModalResenas no est√° disponible');
                alert(`Rese√±as de ${nombrePlato}\n\n(Sistema de rese√±as en desarrollo)`);
            }
        }

        // Copiar la funci√≥n mostrarModalResenas de principal_usar.html
        async function mostrarModalResenas(nombreItem, tipo = null, id = null) {
            // Variables globales necesarias
            window.itemActual = nombreItem;
            window.tipoItemActual = tipo;
            window.idItemActual = id;

            const modal = document.getElementById('modalResenas');
            const titulo = document.getElementById('tituloModal');
            const container = document.getElementById('resenasContainer');

            titulo.textContent = `Rese√±as de ${nombreItem}`;

            try {
                container.innerHTML = '<div class="cargando">üîÑ Cargando rese√±as...</div>';

                let resenasData = [];
                
                if (tipo === 'plato') {
                    console.log('üçΩÔ∏è Cargando rese√±as de plato con ID:', id);
                    const todasLasResenas = await Rese√±asPlatosAPI.obtenerTodas();
                    resenasData = todasLasResenas.filter(resena => resena.platoId === parseInt(id));
                } else if (tipo === 'restaurante') {
                    console.log('üè™ Cargando rese√±as de restaurante con ID:', id);
                    const todasLasResenas = await ResenasRestaurantesAPI.obtenerTodas();
                    resenasData = todasLasResenas.filter(resena => resena.restauranteId === parseInt(id));
                }

                console.log('üìã Rese√±as encontradas:', resenasData.length);

                if (resenasData.length === 0) {
                    container.innerHTML = '<p class="sin-resenas">A√∫n no hay rese√±as para este elemento. ¬°S√© el primero en crear una!</p>';
                } else {
                    // Cargar usuarios para mostrar nombres
                    const usuarios = await UsuariosAPI.obtenerTodos();
                    const usuariosMap = {};
                    usuarios.forEach(usuario => {
                        usuariosMap[usuario.id] = usuario;
                    });

                    // Generar HTML de rese√±as
                    container.innerHTML = resenasData.map(resena => {
                        const usuario = usuariosMap[resena.usuarioId] || { username: 'Usuario desconocido' };
                        const fecha = new Date(resena.fecha).toLocaleDateString('es-ES');
                        
                        return `
                            <div class="resena-item">
                                <div class="resena-header">
                                    <h4 class="nombre-usuario">${usuario.username}</h4>
                                    <div class="calificacion-estrellas">${'‚òÖ'.repeat(resena.calificacion)}${'‚òÜ'.repeat(5 - resena.calificacion)}</div>
                                    <span class="fecha-resena">${fecha}</span>
                                </div>
                                <p class="comentario-resena">${resena.comentario}</p>
                                <div class="resena-footer">
                                    <span class="likes">üëç ${resena.likes} likes</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                }

                // Mostrar modal
                modal.style.display = 'flex';
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';

            } catch (error) {
                console.error('‚ùå Error cargando rese√±as:', error);
                container.innerHTML = '<p class="error-resenas">‚ùå Error al cargar las rese√±as</p>';
            }
        }

        // Hacer las funciones disponibles globalmente
        window.verResenasPlato = verResenasPlato;
        window.mostrarModalResenas = mostrarModalResenas;
    </script>
</body>
</html>