<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio - Restaurantes y Platos</title>
    <link rel="stylesheet" href="../styles/principal_usar.css">
</head>

<body>
    <!-- Header con bienvenida y logo -->
    <header class="encabezado-principal">
        <div class="contenedor-header">
            <div class="seccion-logo">
                <img src="../IMG/logo.png" alt="Logo de la aplicaci√≥n" class="logo-principal">
            </div>
            <div class="seccion-bienvenida">
                <h1 class="mensaje-bienvenida">¬°Bienvenido, <span id="nombreUsuario">Usuario</span>!</h1>
                <p class="subtitulo-bienvenida">Descubre los mejores restaurantes y platos de la ciudad</p>
            </div>
        </div>
    </header>

    <!-- Navegaci√≥n principal -->
    <nav class="navegacion-principal">
        <div class="contenedor-navegacion">
            <button class="boton-navegacion activo" id="btnRestaurantes" data-seccion="restaurantes">
                <span class="texto-nav">Restaurantes</span>
            </button>
            <button class="boton-navegacion" id="btnPlatos" data-seccion="platos">
                <span class="texto-nav">Platos</span>
            </button>
        </div>
    </nav>

    <!-- Contenido principal -->
    <main class="contenido-principal">
        <div class="contenedor-principal">

            <!-- Secci√≥n de Restaurantes -->
            <section class="seccion-contenido activa" id="seccionRestaurantes">
                <div class="encabezado-seccion">
                    <h2 class="titulo-seccion">Restaurantes Disponibles</h2>
                    <div class="filtros-container">
                        <select class="filtro-categoria" id="filtroRestaurantes">
                            <option value="todos">Todas las categor√≠as</option>
                            <option value="fast-food">Fast Food</option>
                            <option value="gourmet">Gourmet</option>
                            <option value="vegetariano">Vegetariano</option>
                            <option value="parrilla">Parrilla</option>
                            <option value="ensaladas">Ensaladas</option>
                        </select>
                    </div>
                </div>

                <div class="grid-contenido" id="gridRestaurantes">
                    <!-- Los restaurantes se cargar√°n din√°micamente desde el backend -->
                    <div class="loading">üçΩÔ∏è Cargando restaurantes...</div>
                </div>
            </section>

            <!-- Secci√≥n de Platos -->
            <section class="seccion-contenido" id="seccionPlatos" style="display: none;">
                <div class="encabezado-seccion">
                    <h2 class="titulo-seccion">Platos Disponibles</h2>
                    <div class="filtros-container">
                        <select class="filtro-categoria" id="filtroPlatos">
                            <option value="todos">Todas las categor√≠as</option>
                            <option value="fast-food">Fast Food</option>
                            <option value="gourmet">Gourmet</option>
                            <option value="vegetariano">Vegetariano</option>
                            <option value="parrilla">Parrilla</option>
                            <option value="ensaladas">Ensaladas</option>
                        </select>
                    </div>
                </div>

                <div class="grid-contenido" id="gridPlatos">
                    <!-- Los platos se cargar√°n din√°micamente desde el backend -->
                    <div class="loading">üçï Cargando platos...</div>
                </div>
            </section>

        </div>
    </main>

    <!-- Modal de Rese√±as -->
    <div id="modalResenas" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="tituloModal">Rese√±as de Restaurante/Plato</h2>
                <button class="boton-cerrar-modal" id="cerrarModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="resenas-container" id="resenasContainer">
                    <!-- Las rese√±as se cargar√°n din√°micamente aqu√≠ -->
                </div>
                <div class="acciones-modal">
                    <button class="boton-crear-resena" id="btnCrearResena">Crear Rese√±a</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Crear Rese√±a -->
    <div id="modalCrearResena" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Nueva Rese√±a</h2>
                <button class="boton-cerrar-modal" id="cerrarModalCrear">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formCrearResena" class="form-resena">
                    <div class="campo-form">
                        <label for="nombreUsuarioResena">Tu nombre:</label>
                        <input type="text" id="nombreUsuarioResena" required>
                    </div>
                    <div class="campo-form">
                        <label for="calificacionResena">Calificaci√≥n:</label>
                        <div class="estrellas-container">
                            <span class="estrella" data-rating="1">‚òÜ</span>
                            <span class="estrella" data-rating="2">‚òÜ</span>
                            <span class="estrella" data-rating="3">‚òÜ</span>
                            <span class="estrella" data-rating="4">‚òÜ</span>
                            <span class="estrella" data-rating="5">‚òÜ</span>
                        </div>
                        <input type="hidden" id="calificacionResena" required>
                    </div>
                    <div class="campo-form">
                        <label for="comentarioResena">Tu rese√±a:</label>
                        <textarea id="comentarioResena" rows="4" placeholder="Escribe tu experiencia aqu√≠..."
                            required></textarea>
                    </div>
                    <div class="acciones-form">
                        <button type="button" class="boton-cancelar" id="cancelarResena">Cancelar</button>
                        <button type="submit" class="boton-enviar">Enviar Rese√±a</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Obtener nombre de usuario
        document.addEventListener('DOMContentLoaded', function () {
            const nombreUsuario = localStorage.getItem('nombreUsuario') || 'Usuario';
            document.getElementById('nombreUsuario').textContent = nombreUsuario;
        });

        // Navegaci√≥n entre secciones
        const botonesNavegacion = document.querySelectorAll('.boton-navegacion');
        const seccionesContenido = document.querySelectorAll('.seccion-contenido');

        botonesNavegacion.forEach(boton => {
            boton.addEventListener('click', function () {
                // Remover clase activa de todos los botones
                botonesNavegacion.forEach(b => b.classList.remove('activo'));
                // Agregar clase activa al bot√≥n clickeado
                this.classList.add('activo');

                const seccion = this.getAttribute('data-seccion');

                // Ocultar todas las secciones
                seccionesContenido.forEach(s => {
                    s.style.display = 'none';
                    s.classList.remove('activa');
                });

                // Mostrar la secci√≥n seleccionada
                const seccionMostrar = document.getElementById(`seccion${seccion.charAt(0).toUpperCase() + seccion.slice(1)}`);
                seccionMostrar.style.display = 'block';
                seccionMostrar.classList.add('activa');
            });
        });

        // Filtros
        function aplicarFiltro(filtro, grid) {
            const tarjetas = grid.querySelectorAll('.tarjeta-item');

            tarjetas.forEach(tarjeta => {
                const categoria = tarjeta.getAttribute('data-categoria');

                if (filtro === 'todos' || categoria === filtro) {
                    tarjeta.style.display = 'block';
                    tarjeta.style.animation = 'fadeIn 0.3s ease';
                } else {
                    tarjeta.style.display = 'none';
                }
            });
        }

        // Filtro de restaurantes
        document.getElementById('filtroRestaurantes').addEventListener('change', function () {
            const filtro = this.value;
            const grid = document.getElementById('gridRestaurantes');
            aplicarFiltro(filtro, grid);
        });

        // Filtro de platos
        document.getElementById('filtroPlatos').addEventListener('change', function () {
            const filtro = this.value;
            const grid = document.getElementById('gridPlatos');
            aplicarFiltro(filtro, grid);
        });

        // Base de datos simulada de rese√±as
        let resenasData = {
            // Restaurantes
            'Pasta Roma': [
                { nombre: 'Mar√≠a Gonz√°lez', calificacion: 5, comentario: 'Excelente pasta italiana, ambiente muy acogedor', fecha: '2024-10-20' },
                { nombre: 'Carlos L√≥pez', calificacion: 4, comentario: 'Muy buena comida, servicio r√°pido y amable', fecha: '2024-10-18' }
            ],
            'Tacos Del Sol': [
                { nombre: 'Ana Mart√≠n', calificacion: 5, comentario: 'Los mejores tacos de la ciudad, totalmente recomendado', fecha: '2024-10-22' }
            ],
            // Platos
            'Pizza Margarita': [
                { nombre: 'Luis Rodr√≠guez', calificacion: 5, comentario: 'Pizza perfecta, ingredientes frescos y masa crujiente', fecha: '2024-10-21' },
                { nombre: 'Sofia Chen', calificacion: 4, comentario: 'Muy rica, el queso estaba perfecto', fecha: '2024-10-19' }
            ],
            'Tiramisu': [
                { nombre: 'Roberto Silva', calificacion: 5, comentario: 'El mejor tiramis√∫ que he probado, textura cremosa perfecta', fecha: '2024-10-17' }
            ]
        };

        let itemActual = '';

        // Funcionalidad de botones
        document.addEventListener('click', function (e) {
            console.log('Clic detectado en:', e.target.className);

            if (e.target.classList.contains('boton-ver-detalle')) {
                const tarjeta = e.target.closest('.tarjeta-item');
                const nombreItem = tarjeta.querySelector('.nombre-item').textContent;
                const seccionActiva = document.querySelector('.seccion-contenido.activa');

                // Si estamos en la secci√≥n de restaurantes, navegar a detalles
                if (seccionActiva && seccionActiva.id === 'seccionRestaurantes') {
                    console.log('Navegando a detalles de restaurante:', nombreItem);
                    localStorage.setItem('restauranteSeleccionado', nombreItem);
                    window.location.href = 'detalle_restaurante.html';
                } else {
                    // Si es un plato, mostrar alert como antes
                    alert(`Viendo detalles de: ${nombreItem}`);
                }
            }

            if (e.target.classList.contains('boton-ver-menu')) {
                const nombreItem = e.target.closest('.tarjeta-item').querySelector('.nombre-item').textContent;
                alert(`Visualizando: ${nombreItem}`);
            }

            if (e.target.classList.contains('boton-ver-resenas')) {
                const nombreItem = e.target.closest('.tarjeta-item').querySelector('.nombre-item').textContent;
                mostrarModalResenas(nombreItem);
            }

            // Clic en imagen de restaurante - solo para la secci√≥n de restaurantes
            if (e.target.classList.contains('imagen-item')) {
                console.log('Clic en imagen detectado');
                const tarjeta = e.target.closest('.tarjeta-item');
                const seccionActiva = document.querySelector('.seccion-contenido.activa');

                console.log('Secci√≥n activa:', seccionActiva ? seccionActiva.id : 'No encontrada');

                // Solo proceder si estamos en la secci√≥n de restaurantes
                if (seccionActiva && seccionActiva.id === 'seccionRestaurantes') {
                    const nombreRestaurante = tarjeta.querySelector('.nombre-item').textContent;
                    console.log('Restaurante seleccionado:', nombreRestaurante);
                    // Guardar informaci√≥n del restaurante en localStorage
                    localStorage.setItem('restauranteSeleccionado', nombreRestaurante);
                    // Confirmar antes de redirigir
                    alert(`Navegando a detalles de: ${nombreRestaurante}`);
                    // Redirigir a la p√°gina de detalles del restaurante
                    window.location.href = 'detalle_restaurante.html';
                } else {
                    console.log('No est√° en la secci√≥n de restaurantes o secci√≥n no encontrada');
                }
            }
        });

        // Funci√≥n para mostrar el modal de rese√±as
        function mostrarModalResenas(nombreItem) {
            itemActual = nombreItem;
            const modal = document.getElementById('modalResenas');
            const titulo = document.getElementById('tituloModal');
            const container = document.getElementById('resenasContainer');

            titulo.textContent = `Rese√±as de ${nombreItem}`;

            // Limpiar container
            container.innerHTML = '';

            // Obtener rese√±as del item
            const resenas = resenasData[nombreItem] || [];

            if (resenas.length === 0) {
                container.innerHTML = '<p class="sin-resenas">A√∫n no hay rese√±as para este item. ¬°S√© el primero en crear una!</p>';
            } else {
                resenas.forEach(resena => {
                    const resenaElement = crearElementoResena(resena);
                    container.appendChild(resenaElement);
                });
            }

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Funci√≥n para crear elemento de rese√±a
        function crearElementoResena(resena) {
            const div = document.createElement('div');
            div.className = 'resena-item';

            const estrellas = '‚òÖ'.repeat(resena.calificacion) + '‚òÜ'.repeat(5 - resena.calificacion);

            div.innerHTML = `
                <div class="resena-header">
                    <h4 class="nombre-usuario">${resena.nombre}</h4>
                    <div class="calificacion-estrellas">${estrellas}</div>
                    <span class="fecha-resena">${resena.fecha}</span>
                </div>
                <p class="comentario-resena">${resena.comentario}</p>
            `;

            return div;
        }

        // Cerrar modal de rese√±as
        document.getElementById('cerrarModal').addEventListener('click', function () {
            document.getElementById('modalResenas').style.display = 'none';
            document.body.style.overflow = 'auto';
        });

        // Abrir modal de crear rese√±a
        document.getElementById('btnCrearResena').addEventListener('click', function () {
            document.getElementById('modalResenas').style.display = 'none';
            document.getElementById('modalCrearResena').style.display = 'flex';

            // Llenar el nombre del usuario si est√° disponible
            const nombreUsuario = localStorage.getItem('nombreUsuario') || '';
            document.getElementById('nombreUsuarioResena').value = nombreUsuario;
        });

        // Cerrar modal de crear rese√±a
        document.getElementById('cerrarModalCrear').addEventListener('click', function () {
            cerrarModalCrearResena();
        });

        document.getElementById('cancelarResena').addEventListener('click', function () {
            cerrarModalCrearResena();
        });

        function cerrarModalCrearResena() {
            document.getElementById('modalCrearResena').style.display = 'none';
            document.body.style.overflow = 'auto';
            limpiarFormularioResena();
        }

        // Sistema de estrellas
        const estrellas = document.querySelectorAll('.estrella');
        let calificacionSeleccionada = 0;

        estrellas.forEach(estrella => {
            estrella.addEventListener('click', function () {
                calificacionSeleccionada = parseInt(this.getAttribute('data-rating'));
                document.getElementById('calificacionResena').value = calificacionSeleccionada;
                actualizarEstrellas();
            });

            estrella.addEventListener('mouseover', function () {
                const rating = parseInt(this.getAttribute('data-rating'));
                destacarEstrellas(rating);
            });
        });

        document.querySelector('.estrellas-container').addEventListener('mouseleave', function () {
            actualizarEstrellas();
        });

        function destacarEstrellas(rating) {
            estrellas.forEach((estrella, index) => {
                if (index < rating) {
                    estrella.textContent = '‚òÖ';
                    estrella.style.color = '#ffc107';
                } else {
                    estrella.textContent = '‚òÜ';
                    estrella.style.color = '#ddd';
                }
            });
        }

        function actualizarEstrellas() {
            destacarEstrellas(calificacionSeleccionada);
        }

        // Enviar rese√±a
        document.getElementById('formCrearResena').addEventListener('submit', function (e) {
            e.preventDefault();

            const nombre = document.getElementById('nombreUsuarioResena').value.trim();
            const calificacion = parseInt(document.getElementById('calificacionResena').value);
            const comentario = document.getElementById('comentarioResena').value.trim();

            if (!nombre || !calificacion || !comentario) {
                alert('Por favor, completa todos los campos');
                return;
            }

            // Crear nueva rese√±a
            const nuevaResena = {
                nombre: nombre,
                calificacion: calificacion,
                comentario: comentario,
                fecha: new Date().toISOString().split('T')[0]
            };

            // Agregar a la base de datos
            if (!resenasData[itemActual]) {
                resenasData[itemActual] = [];
            }
            resenasData[itemActual].unshift(nuevaResena);

            // Cerrar modal y mostrar confirmaci√≥n
            cerrarModalCrearResena();
            alert('¬°Rese√±a creada exitosamente!');

            // Volver a mostrar el modal de rese√±as actualizado
            setTimeout(() => {
                mostrarModalResenas(itemActual);
            }, 500);
        });

        function limpiarFormularioResena() {
            document.getElementById('formCrearResena').reset();
            calificacionSeleccionada = 0;
            actualizarEstrellas();
        }

        // Cerrar modales al hacer clic fuera
        window.addEventListener('click', function (e) {
            const modalResenas = document.getElementById('modalResenas');
            const modalCrear = document.getElementById('modalCrearResena');

            if (e.target === modalResenas) {
                modalResenas.style.display = 'none';
                document.body.style.overflow = 'auto';
            }

            if (e.target === modalCrear) {
                cerrarModalCrearResena();
            }
        });

        // Animaci√≥n de entrada
        window.addEventListener('load', function () {
            const tarjetas = document.querySelectorAll('.tarjeta-item');
            tarjetas.forEach((tarjeta, index) => {
                setTimeout(() => {
                    tarjeta.style.opacity = '1';
                    tarjeta.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>

    <!-- Scripts para conexi√≥n con el backend -->
    <script src="../js/api.js"></script>
    <script src="../js/restaurantes.js"></script>
    <script src="../js/platos.js"></script>

</body>

</html>